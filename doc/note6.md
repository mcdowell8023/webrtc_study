<!--
 * @Author: mcdowell
 * @Date: 2020-05-26 19:34:22
 * @LastEditors: mcdowell
 * @LastEditTime: 2020-05-26 19:49:05
-->

# RTP 及 RTCP 详解

## 实时互动直播系统，是 TCP 还是 UDP

**实时互动直播系统的时候你必须使用 UDP 协议。**

1. UDP 传输快，但不可靠，尤其是在用户的网络质量很差的情况下，基本无法保障音视频的服务质量
2. TCP 比较可靠，为了可靠基本就是，“发送 -> 确认；超时 -> 重发”的反复过程，在这断线重发的过程，最长可达到（失败 7 次）2 分 07 秒， 对于实时直播来说，相当致命。

> 在 TCP 协议中，为了避免重传次数过多，定时器的超时时间会按 2 的指数增长。也就是说，假设第一次设置的超时时间是 1 秒，那么第二次就是 2 秒，第三次是 4 秒……第七次是 64 秒。如果第七次之后仍然超时，则断开 TCP 连接。你可以计算一下，从第一次超时，到最后断开连接，这之间一共经历了 2 分 07 秒

## RTP/RTCP

> 一般情况下，在实时互动直播系统传输音视频数据流时，我们并不直接将音视频数据流交给 UDP 传输，而是**先给音视频数据加个 RTP 头，然后再交给 UDP 进行传输**

以视频帧为例，一个 I 帧的数据量是非常大的，最少也要几十 K.而以太网的最大传输单元是 1.5K，所以要传输一个 I 帧需要几十个包。并且这几十个包传到对端后，还要重新组装成 I 帧，这样才能进行解码还原出一幅幅的图像。

所以要想传输，至少需要以下几个标识。

- **序号**：用于标识传输包的序号，这样就可以知道这个包是第几个分片了。
- **起始标记**：记录分帧的第一个 UDP 包。
- **结束标记**：记录分帧的最后一个 UDP 包。

  有了上面这几个标识字段，我们就可以在发送端进行拆包，在接收端将视频帧重新再组装起来了。
